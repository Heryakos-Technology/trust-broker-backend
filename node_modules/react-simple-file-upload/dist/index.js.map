{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import React, { useRef, useEffect, createContext, useContext } from 'react'\nimport shortid from 'shortid'\nimport makeDebug from 'debug'\n\nexport const SimpleFileUploadContext = createContext({\n  apiKey: '',\n  width: 160,\n  height: 160\n})\n\nexport const useSimpleFileUpload = () => useContext(SimpleFileUploadContext)\n\nexport const SimpleFileUploadProvider = ({\n  apiKey,\n  width,\n  height,\n  children\n}) => {\n  const value = {\n    apiKey,\n    width: +width,\n    height: +height\n  }\n\n  return (\n    <SimpleFileUploadContext.Provider value={value}>\n      {children}\n    </SimpleFileUploadContext.Provider>\n  )\n}\n\n// Add a localStorage entry with the key `debug` and value `SimpleFileUpload` to see debug messages\nconst debug = makeDebug('SimpleFileUpload')\n\nconst SimpleFileUpload = ({ apiKey, onSuccess, width, height, preview, text }) => {\n  const sfu = useSimpleFileUpload()\n  const key = sfu.apiKey || apiKey\n  width = width || sfu.width\n  height = height || sfu.height\n  text = text || \"Drop file to upload\"\n\n  let small = \"false\"\n\n  if (parseInt(width) < 120) {\n    small = \"true\"\n  }\n\n  const widgetId = useRef(shortid.generate())\n\n  useEffect(() => {\n    window.addEventListener('message', handleIframeMessage, false)\n    return () => {\n      window.removeEventListener('message', handleIframeMessage)\n    }\n  })\n  const handleIframeMessage = (e) => {\n    if (e.origin !== 'https://app.simplefileupload.com') {\n      return\n    }\n    // Handle errors (Need iframe to emit an uploadResult of error)\n    if (e.data.uploadResult === 'success') {\n      if (e.data.widgetId !== widgetId.current) {\n        debug('Ignoring because widgetId does not match')\n        return\n      }\n      if (e.data.widgetId === widgetId.current) {\n        debug('Success: %O', e.data)\n        onSuccess(e.data.url)\n      }\n    }\n  }\n  return (\n    <iframe\n      title={`Simple File Upload ${widgetId.current}`}\n      src={`https://app.simplefileupload.com/buckets/${key}?widgetId=${widgetId.current}&preview=${preview}&text=${text}&small=${small}`}\n      className='widgetFrame'\n      width={width}\n      height={height}\n      style={{\n        border: 0\n      }}\n    />\n  )\n}\n\nexport default SimpleFileUpload\n"],"names":["SimpleFileUploadContext","createContext","apiKey","width","height","useSimpleFileUpload","useContext","SimpleFileUploadProvider","children","value","React","debug","makeDebug","SimpleFileUpload","onSuccess","preview","text","sfu","key","small","parseInt","widgetId","useRef","shortid","generate","useEffect","window","addEventListener","handleIframeMessage","removeEventListener","e","origin","data","uploadResult","current","url","border"],"mappings":"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"}